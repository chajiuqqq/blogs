<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="å®éªŒå®¤äºŒæ¬¡å¼€å‘ä¸€ä¸ªblocklyå¹³å°ï¼Œè¿™æ˜¯ä¸€ä¸ªç§¯æœ¨åŒ–ç¼–ç¨‹å¹³å°ï¼Œå¯ä»ç§¯æœ¨ç”Ÿæˆå„ç§è¯­è¨€ä»£ç ï¼Œå¦‚Pythonã€‚ç•Œé¢å¦‚ä¸‹ï¼Œç§¯æœ¨åˆ°ä»£ç ç”±åŸblockl"><title>Blockly2python Web Editionå¼€å‘æµç¨‹</title><link rel=canonical href=http://blogs.chajiuqqq.cn/p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/><link rel=stylesheet href=/scss/style.min.ac77dcf8b111b51da39a92990f431923f210f3876d85798a2125667f96dc33a4.css><meta property="og:title" content="Blockly2python Web Editionå¼€å‘æµç¨‹"><meta property="og:description" content="å®éªŒå®¤äºŒæ¬¡å¼€å‘ä¸€ä¸ªblocklyå¹³å°ï¼Œè¿™æ˜¯ä¸€ä¸ªç§¯æœ¨åŒ–ç¼–ç¨‹å¹³å°ï¼Œå¯ä»ç§¯æœ¨ç”Ÿæˆå„ç§è¯­è¨€ä»£ç ï¼Œå¦‚Pythonã€‚ç•Œé¢å¦‚ä¸‹ï¼Œç§¯æœ¨åˆ°ä»£ç ç”±åŸblockl"><meta property="og:url" content="http://blogs.chajiuqqq.cn/p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/"><meta property="og:site_name" content="èŒ¶é…’çš„å°ç«™"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:published_time" content="2022-10-31T22:19:10+08:00"><meta property="article:modified_time" content="2022-10-31T22:19:10+08:00"><meta name=twitter:title content="Blockly2python Web Editionå¼€å‘æµç¨‹"><meta name=twitter:description content="å®éªŒå®¤äºŒæ¬¡å¼€å‘ä¸€ä¸ªblocklyå¹³å°ï¼Œè¿™æ˜¯ä¸€ä¸ªç§¯æœ¨åŒ–ç¼–ç¨‹å¹³å°ï¼Œå¯ä»ç§¯æœ¨ç”Ÿæˆå„ç§è¯­è¨€ä»£ç ï¼Œå¦‚Pythonã€‚ç•Œé¢å¦‚ä¸‹ï¼Œç§¯æœ¨åˆ°ä»£ç ç”±åŸblockl"><script async src="https://www.googletagmanager.com/gtag/js?id=G-BCR6BTPPNW"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BCR6BTPPNW",{anonymize_ip:!1})}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu4031dbb736a187d9130ab1a88d3b3ee1_9967_300x0_resize_q75_box.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>èŒ¶é…’çš„å°ç«™</a></h1><h2 class=site-description>ä¸€ä¸ªå¹´è½»çš„å°ç«™</h2></div></header><ol class=social-menu><li><a href=https://github.com/chajiuqqq target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>ä¸»é¡µ</span></a></li><li><a href=/%E5%85%B3%E4%BA%8E/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>å…³äº</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=http://blogs.chajiuqqq.cn/en/>English</option><option value=http://blogs.chajiuqqq.cn/ selected>ä¸­æ–‡</option><option value=http://blogs.chajiuqqq.cn/ar/>Ø¹Ø±Ø¨ÙŠ</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>æš—è‰²æ¨¡å¼</span></li></div></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/>Blockly2python Web Editionå¼€å‘æµç¨‹</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Oct 31, 2022</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>é˜…è¯»æ—¶é•¿: 4 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><p>å®éªŒå®¤äºŒæ¬¡å¼€å‘ä¸€ä¸ªblocklyå¹³å°ï¼Œè¿™æ˜¯ä¸€ä¸ªç§¯æœ¨åŒ–ç¼–ç¨‹å¹³å°ï¼Œå¯ä»ç§¯æœ¨ç”Ÿæˆå„ç§è¯­è¨€ä»£ç ï¼Œå¦‚Pythonã€‚ç•Œé¢å¦‚ä¸‹ï¼Œç§¯æœ¨åˆ°ä»£ç ç”±åŸblocklyåº“æä¾›ï¼Œä¸éš¾ã€‚
è€Œè¿è¡Œpythonä»£ç åˆšå¼€å§‹æ˜¯æ”¾åœ¨jupyter notebookï¼Œæ‰‹åŠ¨å¤åˆ¶è¿‡å»è¿è¡Œã€‚
<img src=/p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/blockly1.png width=1920 height=956 srcset="/p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/blockly1_hub3116288970dfe0c4418dcd69b8a6259_195771_480x0_resize_box_3.png 480w, /p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/blockly1_hub3116288970dfe0c4418dcd69b8a6259_195771_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=200 data-flex-basis=482px></p><p>è¿›ä¸€æ­¥ä¼˜åŒ–çš„æ–¹æ¡ˆå°±æ˜¯åœ¨çº¿è¿è¡Œï¼ˆåœ¨æµè§ˆå™¨ï¼‰Pythonä»£ç ã€‚åŸºæœ¬åº“çš„æµè§ˆå™¨åŒ–ä¸éš¾ï¼Œä½†æ˜¯ä¹‹å‰ä¸€ç›´æ²¡æ‰¾åˆ°å¯ä»¥è¿è¡Œç¬¬ä¸‰æ–¹åº“å¦‚pandasçš„jsåº“ã€‚è¿™æ¬¡çœ‹åˆ°<a class=link href=https://pyodide.org/en/stable/index.html target=_blank rel=noopener>pyodide</a>ï¼Œå¯ä»¥å®ç°ç¬¬ä¸‰æ–¹åº“çš„å¯¼å…¥ã€‚äºæ˜¯å¼€å§‹æŠ˜è…¾ã€‚</p><h1 id=åˆæ­¥è¿è¡Œpyodide>åˆæ­¥è¿è¡Œpyodide</h1><p>ç›´æ¥çœ‹å®˜ç½‘çš„ä¾‹å­ï¼Œå¯ä»¥ç›´æ¥è·‘pythonåŸºç¡€åº“ï¼š</p><pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/pyodide/v0.21.3/full/pyodide.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;p&gt;
    You can execute any Python code. Just enter something in the box below and
    click the button.
    &lt;/p&gt;
    &lt;input id=&quot;code&quot; value=&quot;sum([1, 2, 3, 4, 5])&quot; /&gt;
    &lt;button onclick=&quot;evaluatePython()&quot;&gt;Run&lt;/button&gt;
    &lt;br /&gt;
    &lt;br /&gt;
    &lt;div&gt;Output:&lt;/div&gt;
    &lt;textarea id=&quot;output&quot; style=&quot;width: 100%;&quot; rows=&quot;6&quot; disabled&gt;&lt;/textarea&gt;

    &lt;script&gt;
    const output = document.getElementById(&quot;output&quot;);
    const code = document.getElementById(&quot;code&quot;);

    function addToOutput(s) {
        output.value += &quot;&gt;&gt;&gt;&quot; + code.value + &quot;\n&quot; + s + &quot;\n&quot;;
    }

    output.value = &quot;Initializing...\n&quot;;
    // init Pyodide
    async function main() {
        let pyodide = await loadPyodide();
        output.value += &quot;Ready!\n&quot;;
        return pyodide;
    }
    let pyodideReadyPromise = main();

    async function evaluatePython() {
        let pyodide = await pyodideReadyPromise;
        try {
        let output = pyodide.runPython(code.value);
        addToOutput(output);
        } catch (err) {
        addToOutput(err);
        }
    }
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p><img src=/p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/pyodide-demo.png width=861 height=253 srcset="/p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/pyodide-demo_hue20e8405241a231c5633442d0a619047_8568_480x0_resize_box_3.png 480w, /p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/pyodide-demo_hue20e8405241a231c5633442d0a619047_8568_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=340 data-flex-basis=816px></p><h1 id=printé—®é¢˜>printé—®é¢˜</h1><p>åŸºæœ¬åº“pythonä»£ç å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯è¿è¡Œ<code>print('abc')</code>å‡½æ•°æ—¶ï¼Œå‘ç°æ‰“å°çš„ä¸œè¥¿ä¸åœ¨è¿”å›çš„ç»“æœé‡Œï¼Œè€Œæ˜¯åœ¨consoleé‡Œã€‚å¹¸è¿çš„æ˜¯è¿™ä¸ªé—®é¢˜ä¹Ÿæœ‰<a class=link href=https://github.com/pyodide/pyodide/issues/8 target=_blank rel=noopener>issue</a>ã€‚</p><p>è¿™ä¸ªissueä¸‹é¢çš„<a class=link href=https://github.com/pyodide/pyodide/issues/8#issuecomment-772024841 target=_blank rel=noopener>è¿™ä¸ªå›ç­”</a>æä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥å°†æ‰§è¡Œçš„ä»£ç çš„è¾“å‡ºè½¬åˆ°è¿”å›ç»“æœï¼Œè€Œä¸æ˜¯consoleã€‚</p><pre><code>&lt;script type=&quot;text/javascript&quot;&gt;
  // set the pyodide files URL (packages.json, pyodide.asm.data etc)
  window.languagePluginUrl = 'https://cdn.jsdelivr.net/pyodide/v0.16.1/full/';
&lt;/script&gt;
&lt;script src=&quot;https://cdn.jsdelivr.net/pyodide/v0.16.1/full/pyodide.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
function setup_pyodide() {
    // setup pyodide environment to run code blocks as needed
    var setup_code = `
    import sys, io, traceback
    namespace = {}  # use separate namespace to hide run_code, modules, etc.
    def run_code(code):
    &quot;&quot;&quot;run specified code and return stdout and stderr&quot;&quot;&quot;
    out = io.StringIO()
    oldout = sys.stdout
    olderr = sys.stderr
    sys.stdout = sys.stderr = out
    try:
        # change next line to exec(code, {}) if you want to clear vars each time
        exec(code, namespace)
    except:
        traceback.print_exc()

    sys.stdout = oldout
    sys.stderr = olderr
    return out.getvalue()
    `
    pyodide.runPython(setup_code)
}

function runPython() {
    // run code currently stored in editor
    pyodide.globals.code_to_run = editor.getValue()
    document.getElementById(&quot;output&quot;).value = pyodide.runPython('run_code(code_to_run)')
}

// run setup_pyodide() when pyodide finishes loading
languagePluginLoader.then(setup_pyodide)

&lt;/script&gt;
</code></pre><p>æ³¨æ„ä»–ç”¨çš„æ˜¯v0.16.1ç‰ˆæœ¬pyodideï¼Œæœ€æ–°çš„0.21.3ä¼šæŠ¥é”™ã€‚ä½†æ˜¯æ€è·¯å¾ˆå¥½ï¼Œè´´ä¸€ä¸‹æˆ‘è‡ªå·±ä¿®æ”¹çš„0.21.3ç‰ˆæœ¬ä»£ç ,åŸç†å°±æ˜¯æŠŠè¿è¡Œçš„ä»£ç å½“ä½œå‚æ•°è¾“å…¥é¢„å…ˆè¿è¡Œçš„run_codeå‡½æ•°ï¼š</p><pre><code>&lt;script src=&quot;https://cdn.jsdelivr.net/pyodide/v0.21.3/full/pyodide.js&quot;&gt;&lt;/script&gt;

&lt;script&gt;
    const output = document.getElementById(&quot;output&quot;);
    const pyplotfigure = document.getElementById(&quot;pyplotfigure&quot;);

    function addToOutput(s) {
        output.value += &quot;&gt;&gt;&gt;  &quot; + s + &quot;\n&quot;;
    }

    output.value = &quot;Initializing...\n&quot;;

    function clearOutput() {
        output.value = 'Ready!\n'
        pyplotfigure.src=''
    }


    let pyodide 

    async function runPython() {
        // run code currently stored in editor
        let code_to_run = editor.getValue()
        await pyodide.loadPackagesFromImports(code_to_run);
        pyodide.globals.set('code_to_run',code_to_run);
        addToOutput(pyodide.runPython('run_code(code_to_run)'));
    }
    async function main(){
        pyodide = await loadPyodide();
        // await pyodide.loadPackage(['pandas','matplotlib']);
        var setup_code = `
    import sys, io, traceback
    namespace = {}  # use separate namespace to hide run_code, modules, etc.
    def run_code(_code):
        &quot;&quot;&quot;run specified code and return stdout and stderr&quot;&quot;&quot;
        namespace={}
        _out = io.StringIO()
        _oldout = sys.stdout
        _olderr = sys.stderr
        sys.stdout = sys.stderr = _out
        try:
            # change next line to exec(code, {}) if you want to clear vars each time
            exec(_code,namespace)
        except:
            traceback.print_exc()
    
        sys.stdout = _oldout
        sys.stderr = _olderr
        return _out.getvalue()
    `
        pyodide.runPython(setup_code)

        output.value += 'Ready!\n'
    }
    
    main()

&lt;/script&gt;
</code></pre><h1 id=ç”»å›¾æ˜¾ç¤ºé—®é¢˜>ç”»å›¾æ˜¾ç¤ºé—®é¢˜</h1><p>è¿™ä¸‹printæ²¡é—®é¢˜äº†ï¼Œä¸‹é¢è§£å†³ç”»å›¾çš„é—®é¢˜ã€‚ä¸Šé¢çš„</p><pre><code>await pyodide.loadPackagesFromImports(code_to_run);
</code></pre><p>ä¼šè‡ªåŠ¨è¯†åˆ«importå¹¶å¯¼å…¥å¯¹åº”pythonåº“çš„jsç‰ˆæœ¬ã€‚ä½†æ˜¯matplotlabç”»å›¾æ²¡æ³•ç›´æ¥å‡ºæ¥ã€‚æˆ‘æ‰¾äº†ä¸¤ä¸ªè§£å†³æ–¹æ³•</p><ul><li>ä¿®æ”¹matplotlabçš„<a class=link href=https://matplotlib.org/stable/users/explain/backends.html#selecting-a-backend target=_blank rel=noopener>backends</a>ï¼Œå¯ä»¥æŠŠå›¾ç‰‡è¾“å‡ºæˆcanvasåœ¨é¡µé¢ä¸­æ˜¾ç¤º</li><li>ä¿å­˜å›¾ç‰‡çš„base64ç¼–ç ï¼Œç„¶åhtmlä¸­çš„imgè¯»å–base64ç¼–ç æ˜¾ç¤ºå›¾ç‰‡</li></ul><p><strong>ç¬¬ä¸€ä¸ªæ–¹æ³•</strong>å‚è€ƒè¿™ä¸ª<a class=link href=https://blog.pyodide.org/posts/canvas-renderer-matplotlib-in-pyodide/ target=_blank rel=noopener>blog</a>ï¼Œé‡Œé¢æåˆ°çš„è¿™ä¸ª<a class=link href=https://jsfiddle.net/gh/get/library/pure/pyodide/pyodide-blog/contents/demos/canvas-renderer-matplotlib/demo-1/ target=_blank rel=noopener>demo</a>ç”¨å¤„å¾ˆå¤§ï¼Œç›´æ¥æ˜¾ç¤ºäº†å¦‚ä½•ä»matplotlabæ˜¾ç¤ºå›¾åƒåˆ°ç½‘é¡µã€‚</p><p><img src=/p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/demo2.png width=1709 height=481 srcset="/p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/demo2_hua31076cea541db4698eea6ed159fad99_97981_480x0_resize_box_3.png 480w, /p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/demo2_hua31076cea541db4698eea6ed159fad99_97981_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=355 data-flex-basis=852px></p><p>ä½¿ç”¨æ–¹æ³•å°±æ˜¯åœ¨è¿è¡Œçš„pythonä»£ç é‡Œï¼Œæœ€å‰é¢åŠ ä¸Š</p><pre><code>import matplotlib
matplotlib.use(&quot;module://matplotlib.backends.html5_canvas_backend&quot;)
</code></pre><p>æŒ‡å®šmatplotlabçš„backendä¸ºhtml5_canvas_backendï¼Œå°±å¯ä»¥ç”Ÿæˆcanvasäº†ï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜æ˜¯æˆ‘ä¸çŸ¥é“å¦‚ä½•æ§åˆ¶è¿™ä¸ªcanvasçš„ä½ç½®ï¼Œäºæ˜¯ä½¿ç”¨ç¬¬äºŒä¸ªæ–¹æ³•ã€‚</p><p><strong>ç¬¬äºŒä¸ªæ–¹æ³•</strong>å‚è€ƒè¿™ä¸ª<a class=link href="https://codepen.io/aagostini/pen/LYExVJL?editors=1000" target=_blank rel=noopener>ç½‘é¡µ</a>ï¼Œè™½ç„¶å®ƒçš„pyodide.jsé“¾æ¥å¤±æ•ˆäº†çœ‹ä¸å‡ºæ•ˆæœï¼Œä½†æ˜¯å¯ä»¥ä¿®æ”¹ä¸€ä¸‹ï¼Œçœ‹åˆ°matplotlabä½œå›¾å‡ºç°åœ¨htmlä¸Šäº†ï¼š</p><p><img src=/p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/demo3.png width=672 height=523 srcset="/p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/demo3_hu6129f7b5febdece6f7990ff7a3cd189c_23069_480x0_resize_box_3.png 480w, /p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/demo3_hu6129f7b5febdece6f7990ff7a3cd189c_23069_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=128 data-flex-basis=308px></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>&lt;!doctype html&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Demo&lt;/title&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/pyodide/v0.16.1/full/pyodide.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
    languagePluginLoader.then(() =&gt; {
    pyodide.loadPackage(['matplotlib']).then(() =&gt; {
        pyodide.runPython(`
                import matplotlib.pyplot as plt
                import io, base64
                fig, ax = plt.subplots()
                ax.plot([1,3,2])
                buf = io.BytesIO()
                fig.savefig(buf, format='png')
                buf.seek(0)
                img_str = 'data:image/png;base64,' + base64.b64encode(buf.read()).decode('UTF-8')`
        );
        document.getElementById(&quot;pyplotfigure&quot;).src=pyodide.globals.img_str

    });});

    &lt;/script&gt;

    &lt;div id=&quot;textfield&quot;&gt;A matplotlib figure:&lt;/div&gt;
    &lt;div id=&quot;pyplotdiv&quot;&gt;&lt;img id=&quot;pyplotfigure&quot;/&gt;&lt;/div&gt;
&lt;html&gt;
</code></pre><h1 id=æ•´åˆ>æ•´åˆ</h1><p>æŠŠè§£å†³printçš„æ–¹æ³•å’Œç¬¬äºŒä¸ªè¾“å‡ºå›¾ç‰‡çš„æ–¹æ³•ç»“åˆèµ·æ¥æœ‰ç‚¹å°æ’æ›²ï¼Œä¸€å¼€å§‹ä¿®æ”¹runPython()</p><pre><code>async function runPython() {
    // run code currently stored in editor
    let code_to_run = editor.getValue()
    await pyodide.loadPackagesFromImports(code_to_run);
    pyodide.globals.set('code_to_run',code_to_run);
    addToOutput(pyodide.runPython('run_code(code_to_run)'));

    let a = pyodide.globals.get('img_str')
    if(a){
        pyplotfigure.src=a
    }
}
</code></pre><p>ä½†æ˜¯<code>let a = pyodide.globals.get('img_str')</code>ä¸€å¼€å§‹æç¤ºæ— æ³•æ‰¾åˆ°img_strï¼Œåæ¥å‘ç°æ˜¯namespaceçš„é”…ï¼š</p><pre><code> exec(_code,namespace)
</code></pre><p>è¿™ä¸ªä¼šåœ¨ä¸€ä¸ªæ–°çš„namespaceé‡Œæ‰§è¡Œï¼Œæ‰€ä»¥åœ¨å¤–é¢æ‰¾ä¸åˆ°é‡Œé¢å®šä¹‰çš„img_strï¼Œæ”¹ä¸º</p><pre><code>exec(_code,globals())
</code></pre><p>ä½¿ç”¨å…¨å±€çš„namespaceï¼Œå°±å¯ä»¥çœ‹åˆ°å›¾ç‰‡äº†</p><p>æœ€åä»£ç ï¼š</p><p>jsï¼š</p><pre><code>&lt;script src=&quot;https://cdn.jsdelivr.net/pyodide/v0.21.3/full/pyodide.js&quot;&gt;&lt;/script&gt;

&lt;script&gt;
    const output = document.getElementById(&quot;output&quot;);
    const pyplotfigure = document.getElementById(&quot;pyplotfigure&quot;);

    function addToOutput(s) {
        output.value += &quot;&gt;&gt;&gt;  &quot; + s + &quot;\n&quot;;
    }

    output.value = &quot;Initializing...\n&quot;;

    function clearOutput() {
        output.value = 'Ready!\n'
        pyplotfigure.src=''
    }


    let pyodide 

    async function runPython() {
        // run code currently stored in editor
        let code_to_run = editor.getValue()
        await pyodide.loadPackagesFromImports(code_to_run);
        pyodide.globals.set('code_to_run',code_to_run);
        addToOutput(pyodide.runPython('run_code(code_to_run)'));

        let a = pyodide.globals.get('img_str')
        if(a){
            pyplotfigure.src=a
        }
    }
    async function main(){
        pyodide = await loadPyodide();
        // await pyodide.loadPackage(['pandas','matplotlib']);
        var setup_code = `
    import sys, io, traceback
    namespace = {}  # use separate namespace to hide run_code, modules, etc.
    def run_code(_code):
        &quot;&quot;&quot;run specified code and return stdout and stderr&quot;&quot;&quot;
        _out = io.StringIO()
        _oldout = sys.stdout
        _olderr = sys.stderr
        sys.stdout = sys.stderr = _out
        try:
            # change next line to exec(code, {}) if you want to clear vars each time
            exec(_code,globals())
        except:
            traceback.print_exc()
    
        sys.stdout = _oldout
        sys.stderr = _olderr
        return _out.getvalue()
    `
        pyodide.runPython(setup_code)

        output.value += 'Ready!\n'
    }
    
    main()
&lt;/script&gt;
</code></pre><p>htmlè¦åŠ ä¸Šæ”¾å›¾ç‰‡çš„åœ°æ–¹ï¼š</p><pre><code>&lt;div id=&quot;pyplotdiv&quot;&gt;&lt;img id=&quot;pyplotfigure&quot; style=&quot;width: 100% ;&quot;/&gt;&lt;/div&gt;
</code></pre><p>æœ€åå±•ç¤ºä¸€ä¸‹ï¼š</p><p><img src=/p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/blockly2.png width=1920 height=950 srcset="/p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/blockly2_hud88af843e7fc05c8a3089f4e81c8046f_281315_480x0_resize_box_3.png 480w, /p/blockly2python-web-edition%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/blockly2_hud88af843e7fc05c8a3089f4e81c8046f_281315_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=202 data-flex-basis=485px></p></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 èŒ¶é…’çš„å°ç«™</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.13.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>